[Pipeline] { (Pre-deploy health checks (Cognos REST + MotioCI))
[Pipeline] container
[Pipeline] {
[Pipeline] sh
11:28:18  + set -eu
11:28:18  + '[' -f MotioCI/api/motio_env ']'
11:28:18  + . MotioCI/api/motio_env
11:28:18  ++ COGNOS_SESSION_KEY='CAM MTsxMDE6YWM1YjdlOWUtMWJjZi1kOTRhLWUxYjktYTU4NDgzMGU4ZDg5OjA2MzE4NzQzODk7MDszOzA7'
11:28:18  ++ COGNOS_XSRF=
11:28:18  ++ COGNOS_AUTH_VALUE='CAM MTsxMDE6YWM1YjdlOWUtMWJjZi1kOTRhLWUxYjktYTU4NDgzMGU4ZDg5OjA2MzE4NzQzODk7MDszOzA7'
11:28:18  + BASE=https://dhcsprodcognos.ca.analytics.ibm.com/api/v1
11:28:18  + echo '1) Cognos REST check: /extensions with session_key'
11:28:18  1) Cognos REST check: /extensions with session_key
11:28:18  + set -- -H 'IBM-BA-Authorization: CAM MTsxMDE6YWM1YjdlOWUtMWJjZi1kOTRhLWUxYjktYTU4NDgzMGU4ZDg5OjA2MzE4NzQzODk7MDszOzA7' -H 'Accept: application/json'
11:28:18  + '[' -n '' ']'
11:28:18  + curl -sS --fail-with-body https://dhcsprodcognos.ca.analytics.ibm.com/api/v1/extensions -H 'IBM-BA-Authorization: CAM MTsxMDE6YWM1YjdlOWUtMWJjZi1kOTRhLWUxYjktYTU4NDgzMGU4ZDg5OjA2MzE4NzQzODk7MDszOzA7' -H 'Accept: application/json' -c cookies.txt -b cookies.txt -D headers.txt -o extensions.json
11:28:19  + python3 -
11:28:19  Cognos REST OK.
11:28:19  + echo '2) MotioCI project presence on PRD'
11:28:19  2) MotioCI project presence on PRD
11:28:19  + cd MotioCI/api/CLI
11:28:19  + python3 ci-cli.py --server=https://cgrptmcip01.cloud.cammis.ca.gov project ls --xauthtoken=4593cb0d-d7f6-47a4-afd0-44ad05343235 --instanceName=Cognos-PRD
11:28:19  + tee projects_prd.txt
11:28:19  {'node': {'id': 1, 'name': 'Admin', 'description': None}}
11:28:19  {'node': {'id': 13, 'name': 'Deployments', 'description': None}}
11:28:19  {'node': {'id': 18, 'name': 'Demo', 'description': None}}
11:28:19  + grep -i -F -q Demo projects_prd.txt
11:28:19  + echo 'MotioCI project OK.'
11:28:19  MotioCI project OK.
11:28:19  + cd -
11:28:19  + echo '3) MotioCI namespace check on PRD (expects '\''AzureAD'\'')'
11:28:19  3) MotioCI namespace check on PRD (expects 'AzureAD')
11:28:19  + curl -sS --fail-with-body -X POST https://cgrptmcip01.cloud.cammis.ca.gov/api/graphql -H 'Content-Type: application/json' -H 'x-auth-token: 4593cb0d-d7f6-47a4-afd0-44ad05343235' -d '{"query":"query($id: Long!){ instance(id:$id){ namespaces { id name } } }", "variables":{"id":1}}'
11:28:21  + echo 'Namespaces returned by PRD (name/id):'
11:28:21  Namespaces returned by PRD (name/id):
11:28:21  + python3 -
11:28:21  - BAOps (id=BAOps)
11:28:21  - LDAP (id=LDAP)
11:28:21  - Azure (id=AzureAD)
11:28:21  + mkdir -p MotioCI/api
11:28:21  + python3 -
11:28:21  ERROR: Namespace 'AzureAD' not found on PRD. Set COGNOS_NAMESPACE to one of:
11:28:21    - BAOps (id=BAOps)
11:28:21    - LDAP (id=LDAP)
11:28:21    - Azure (id=AzureAD)
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy (DEV/TEST → PRD))
Stage "Deploy (DEV/TEST → PRD)" skipped due to earlier failure(s)
[Pipeline] getContext
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] echo
11:28:21  Pipeline execution finished.
[Pipeline] echo
11:28:21  MotioCI pipeline failed.
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // timestamps
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] }
[Pipeline] // podTemplate
[Pipeline] End of Pipeline
ERROR: script returned exit code 1

GitHub has been notified of this commit’s build result

/var/lib/jenkins/jobs/Cognos Jobs/jobs/Cognos_deployment_pipeline/workspace/newtesting@tmp/jfrog/39/.jfrog deleted
Finished: FAILURE
