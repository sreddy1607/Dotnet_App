    stage('Login to cognos API') {
      steps {
        script {
          withCredentials([usernamePassword(credentialsId: 'Cognos_authentication', passwordVariable: 'COGNOS_PASSWORD', usernameVariable: 'COGNOS_USERNAME')]) {
            def response = sh(script: """
            curl -X PUT \
                 -H "Content-Type: application/json" \
                 -d '{
                    "username": "${COGNOS_USERNAME}",
                    "password": "${COGNOS_PASSWORD}"
                  }' \
                  ${COGNOS_API_URL}/session \
                -o response.json
                """, returnStdout:true).trim()
            
            def jsonResponse = readJSON file: 'response.json'
            if (jsonResponse.authToken) {
              env.COGNOS_AUTH_TOKEN = jsonResponse.authToken
              echo "Successfully authenticated. Token: ${env.COGNOS_AUTH_TOKEN}"
            } else {
              error "Failed to authenticate with Cognos API"
            }
          }
        }
      }
    }


    stage('Use Cognos API') {
      steps {
          script {
            def reportResponse = sh(script: """
            curl -X GET \
                 -H "Auhtorization: Bearer ${env.COGNOS_AUTH_TOKEN}" \
                 -H "Content-type: application/json" \
                 ${COGNOS_API_URL}/files \
                 -o report_response.json
            """, returnStdout:true).trim()
          echo "Report Response: ${reportResponse}"
        }
      }
    }
  }
